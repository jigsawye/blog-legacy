webpackJsonp([0xe5c0ee48b3ba],{442:function(a,n){a.exports={data:{site:{siteMetadata:{title:"JIGSAWYE",author:"Evan Ye",siteUrl:"https://jigsawye.com",disqusShortname:"jigsawnotes"}},markdownRemark:{id:"/Users/jigsawye/projects/gatsby-blog/content/posts/2015-06-22-using-pjax-with-laravel-5.md absPath of file >>> MarkdownRemark",html:'<blockquote>\n<p>本文適用於 Laravel 5.0 以上版本。</p>\n</blockquote>\n<h4 id="什麼是-pjax-？"><a href="#%E4%BB%80%E9%BA%BC%E6%98%AF-pjax-%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>什麼是 PJAX ？</h4>\n<p>簡單來說，以往使用的 <code class="language-text">AJAX</code> 可以不重新載入網頁，異步載入伺服器的資料，並更新畫面。而 <code class="language-text">PJAX</code> 則是加入了 HTML5 的 <code class="language-text">PushState</code> 技術，在取得資料的同時改變 Url，可以保留瀏覽器上一頁的功能，而且不會從伺服器重新載入 js 及 css 之類的靜態檔案，加快網頁的載入速度。</p>\n<!-- more -->\n<h4 id="開始上手"><a href="#%E9%96%8B%E5%A7%8B%E4%B8%8A%E6%89%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>開始上手</h4>\n<h5 id="伺服器端安裝-jacobbennettpjax"><a href="#%E4%BC%BA%E6%9C%8D%E5%99%A8%E7%AB%AF%E5%AE%89%E8%A3%9D-jacobbennettpjax" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>伺服器端安裝 <code class="language-text">jacobbennett/pjax</code></h5>\n<p>在 Laravel 我們需要安裝 <code class="language-text">jacobbennett/pjax</code> 這隻 Package（<a href="https://github.com/JacobBennett/pjax">Github</a>），他會根據 Request 是否為 PJAX 來回傳對應資料。安裝請直接修改 <code class="language-text">composer.json</code>：</p>\n<div class="gatsby-highlight" data-language="js">\n      <pre class="language-js"><code class="language-js"><span class="token operator">...</span>\n<span class="token string">"require"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    <span class="token operator">...</span>\n    <span class="token string">"jacobbennett/pjax"</span><span class="token punctuation">:</span> <span class="token string">"0.*"</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n<span class="token operator">...</span></code></pre>\n      </div>\n<p>接著執行 <code class="language-text">composer update</code> 或是 <code class="language-text">composer install</code> 安裝 package。</p>\n<p>安裝完成後，我們要把 <code class="language-text">jacobbennett/pjax</code> 的 middleware 加到我們預設的 middleware 中，打開 <code class="language-text">app/Http/Kernel.php</code>，在 <code class="language-text">$middleware</code> 增加：</p>\n<div class="gatsby-highlight" data-language="php">\n      <pre class="language-php"><code class="language-php"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n<span class="token keyword">protected</span> <span class="token variable">$middleware</span> <span class="token operator">=</span> <span class="token punctuation">[</span>\n    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n    <span class="token single-quoted-string string">\'JacobBennett\\Pjax\\PjaxMiddleware\'</span><span class="token punctuation">,</span>\n<span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre>\n      </div>\n<p>這樣 Laravel 的部分就準備完成了。</p>\n<h5 id="前端安裝-jquerypjax"><a href="#%E5%89%8D%E7%AB%AF%E5%AE%89%E8%A3%9D-jquerypjax" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>前端安裝 <code class="language-text">jQuery.pjax</code></h5>\n<p>前端部分使用 <code class="language-text">jQuery.pjax</code> 這隻 Library，<code class="language-text">jQuery.pjax</code> 是基於 jQuery，並封裝了 pushState 與 AJAX ，讓你更容易使用 PJAX 的 Library，關於此 Library 可以參閱 <a href="https://github.com/defunkt/jquery-pjax">jQuery.pjax 的 Github</a>。另外 <code class="language-text">jQuery.pjax</code> 依賴於 <code class="language-text">jQuery 1.8.x</code> 以上，所以安裝前請確保你的專案有載入 <code class="language-text">jQuery</code>。</p>\n<p>下載 <code class="language-text">jquery.pjax.js</code> 至你的專案中，本範例下載至專案的 <code class="language-text">/public/javascripts</code> 資料夾，我習慣使用 <code class="language-text">wget</code>，你可以使用你習慣的方式下載，像是 <code class="language-text">curl</code> 或是直接用瀏覽器：</p>\n<div class="gatsby-highlight" data-language="bash">\n      <pre class="language-bash"><code class="language-bash">$ <span class="token function">wget</span> -P public/javascripts https://raw.github.com/defunkt/jquery-pjax/master/jquery.pjax.js</code></pre>\n      </div>\n<p>接著在你的 <code class="language-text">views</code> 中載入檔案：</p>\n<div class="gatsby-highlight" data-language="xml">\n      <pre class="language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{ assets(<span class="token punctuation">\'</span>javascripts/jquery.pjax.js<span class="token punctuation">\'</span>) }}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre>\n      </div>\n<p>最後增加 JavaScript：</p>\n<div class="gatsby-highlight" data-language="js">\n      <pre class="language-js"><code class="language-js"><span class="token function">$</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ready</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token punctuation">{</span>\n    <span class="token function">$</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pjax</span><span class="token punctuation">(</span><span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token string">\'body\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>\n      </div>\n<p>上方程式的第一個參數代表會攔截所有的 <code class="language-text">a</code> 標籤，若瀏覽器有支援就改以 PJAX 的方式送出，第二個參數代表接收到的資料替換至 <code class="language-text">body</code>。</p>\n<p>另外，PushState 有瀏覽器支援的問題（萬惡的 IE），支援度可以至 <a href="http://caniuse.com/#search=pushstate">Can I use</a> 查看，不過這不用擔心，若瀏覽器不支援 PushState，就會以原始方式打開超連結。</p>\n<h4 id="完成！"><a href="#%E5%AE%8C%E6%88%90%EF%BC%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>完成！</h4>\n<p>完成上面的步驟後你的專案就擁有 PJAX 的功能了，打開 Devtools 的 Network 畫面，點擊任一 <code class="language-text">a</code> 標籤，就會看到帶有 <code class="language-text">_pjax=body</code> 的 Request ，接著畫面就會更新了！</p>\n<p><img src="http://i.imgur.com/xrKP9S0.png"></p>\n<h4 id="加上載入動畫"><a href="#%E5%8A%A0%E4%B8%8A%E8%BC%89%E5%85%A5%E5%8B%95%E7%95%AB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>加上載入動畫</h4>\n<p>不過這樣的 UX 不是很好，有時點擊連結後有某些原因造成等待的時間較久，使用者可能覺得沒反應就會重新載入，或是重複點擊，這樣的效果並不好，所以我們要加上載入動畫，實作效果可以參考 Youtube（下圖畫面上方的紅色讀取條）。</p>\n<p><img src="http://i.imgur.com/rXvQMSS.png"></p>\n<h6 id="安裝-nprogressjs"><a href="#%E5%AE%89%E8%A3%9D-nprogressjs" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>安裝 nprogress.js</h6>\n<p><code class="language-text">nprogress.js</code> 是一個載入動畫的 Library，效果可以參考<a href="http://ricostacruz.com/nprogress/">它的官方網站</a>，也可在<a href="https://github.com/rstacruz/nprogress">它的 Github</a> 參考使用的 API。</p>\n<p>下載檔案至專案中：</p>\n<div class="gatsby-highlight" data-language="bash">\n      <pre class="language-bash"><code class="language-bash">$ <span class="token function">wget</span> -P public/javascripts http://ricostacruz.com/nprogress/nprogress.js\n$ <span class="token function">wget</span> -P public/stylesheets http://ricostacruz.com/nprogress/nprogress.css</code></pre>\n      </div>\n<p>接著在 <code class="language-text">views</code> 載入檔案：</p>\n<div class="gatsby-highlight" data-language="xml">\n      <pre class="language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{ asset(<span class="token punctuation">\'</span>stylesheets/nprogress.css<span class="token punctuation">\'</span>) }}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{ assets(<span class="token punctuation">\'</span>javascripts/nprogress.js<span class="token punctuation">\'</span>) }}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre>\n      </div>\n<p>最後把效果加到 PJAX 的生命週期中：</p>\n<div class="gatsby-highlight" data-language="js">\n      <pre class="language-js"><code class="language-js"><span class="token function">$</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ready</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token punctuation">{</span>\n    <span class="token function">$</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pjax</span><span class="token punctuation">(</span><span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token string">\'body\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">$</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'pjax:start\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        NProgress<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">$</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'pjax:end\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        NProgress<span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>\n      </div>\n<h6 id="噹啷！完成！"><a href="#%E5%99%B9%E5%95%B7%EF%BC%81%E5%AE%8C%E6%88%90%EF%BC%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>噹啷！完成！</h6>\n<p>至此你的專案已經擁有完整的 PJAX 了！</p>\n<h4 id="q--a："><a href="#q--a%EF%BC%9A" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Q &#x26; A：</h4>\n<p>Q：我不喜歡 nprogress 的效果，有沒有別的可以用？\nA：你可以考慮使用 <a href="http://github.hubspot.com/pace/docs/welcome/">PACE</a>、<a href="http://usablica.github.io/progress.js/">Progress.js</a>，不過我都沒使用過，但方式應該是大同小異。</p>\n<p>Q：為什麼我的一些 JavaScript Library 會爆掉沒反應？\nA：你使用的 Library 如果需要在畫面載入完時重新初始化（像是 <a href="http://portfoliojs.com/">portfolio.js</a>），請把相關程式碼放入 <code class="language-text">PJAX</code> 的生命週期中，如下：</p>\n<div class="gatsby-highlight" data-language="js">\n      <pre class="language-js"><code class="language-js"><span class="token function">$</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'pjax:end\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">initPortfolio</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    NProgress<span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>\n      </div>\n<p>有其他問題也可以留言，我會盡力幫助你的 :)</p>\n<p>References: <a href="https://phphub.org/topics/44">PHPHub</a></p>',fields:{slug:"/2015/06/22/using-pjax-with-laravel-5/"},frontmatter:{title:"在 Laravel 5 使用 PJAX 加快網頁載入速度",date:"June 22, 2015"}}},pathContext:{slug:"/2015/06/22/using-pjax-with-laravel-5/"}}}});
//# sourceMappingURL=path---2015-06-22-using-pjax-with-laravel-5-fe5ce50e1893066d176b.js.map